<div *ngIf="request | async as r" class="row">
  <div *ngIf="auth.user$ | async as user">
    <ng-container *ngIf="auth.isAdmin(user); else employerSummary">
      <div class="col-12">
        <div class="row">
          <div class="col-lg-4 col-md-12 col-sm-12 col-12">
            <div class="emp_job_post jb_cover">
              <div class="emp_job_side_img">
                <i class="fas fa-book"></i>
              </div>
              <div class="emp_job_side_text">
                <h1>{{ r.no >= 1 ? r.no : "None" }}</h1>
                <p>requested</p>
              </div>
            </div>
          </div>
          <div class="col-lg-4 col-md-12 col-sm-12 col-12">
            <div class="emp_job_post jb_cover">
              <div class="emp_job_side_img greens">
                <i class="fas fa-eye"></i>
              </div>
              <div class="emp_job_side_text">
                <h1>
                  {{
                    (r.invitees || []).length >= 1
                      ? (r.invitees || []).length
                      : "None"
                  }}
                </h1>
                <p>invited</p>
              </div>
            </div>
          </div>
          <div class="col-lg-4 col-md-12 col-sm-12 col-12">
            <div class="emp_job_post jb_cover">
              <div class="emp_job_side_img parts">
                <i class="fas fa-envelope-open-text"></i>
              </div>
              <div class="emp_job_side_text">
                <h1>
                  {{
                    (r.confirmed || []).length >= 1
                      ? (r.confirmed || []).length
                      : "None"
                  }}
                </h1>
                <p>applied</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
    <ng-template #employerSummary>
      <div class="col-12">
        <div class="row">
          <div class="col-lg-4 col-md-12 col-sm-12 col-12">
            <div class="emp_job_post jb_cover">
              <div class="emp_job_side_img">
                <i class="fas fa-book"></i>
              </div>
              <div class="emp_job_side_text">
                <h1>{{ r.no >= 1 ? r.no : "None" }}</h1>
                <p>requested</p>
              </div>
            </div>
          </div>
          <div class="col-lg-4 col-md-12 col-sm-12 col-12">
            <div class="emp_job_post jb_cover">
              <div class="emp_job_side_img greens">
                <i class="fas fa-eye"></i>
              </div>
              <div class="emp_job_side_text">
                <h1>
                  {{ r.delivered ? (r.confirmed || []).length : "None" }}
                </h1>
                <p>delivered</p>
              </div>
            </div>
          </div>
          <div class="col-lg-4 col-md-12 col-sm-12 col-12">
            <div class="emp_job_post jb_cover">
              <div class="emp_job_side_img parts">
                <i class="fas fa-envelope-open-text"></i>
              </div>
              <div class="emp_job_side_text">
                <h1>
                  {{ r.delivered ? "Delivered" : "Processing" }}
                </h1>
                <p>status</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-template>

    <div class="col-12">
      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-12">
          <div class="job_filter_category_sidebar jb_cover">
            <div class="job_filter_sidebar_heading jb_cover">
              <h1>
                basic information
                <span
                  ><a href="#" data-toggle="modal" data-target="#myModal1"
                    ><i class="fas fa-edit"></i></a
                ></span>
              </h1>
            </div>
            <div class="job_overview_header jb_cover">
              <div class="row">
                <div class="col-lg-6 col-md-12 col-sm-12 col-12">
                  <div class="jp_listing_overview_list_main_wrapper jb_cover">
                    <div class="jp_listing_list_icon">
                      <i class="fas fa-tag"></i>
                    </div>
                    <div class="jp_listing_list_icon_cont_wrapper">
                      <ul>
                        <li>job title:</li>
                        <li>{{ r.title }}</li>
                      </ul>
                    </div>
                  </div>
                  <div class="jp_listing_overview_list_main_wrapper jb_cover">
                    <div class="jp_listing_list_icon">
                      <i class="fas fa-users"></i>
                    </div>
                    <div class="jp_listing_list_icon_cont_wrapper">
                      <ul>
                        <li>Number of workers:</li>
                        <li>{{ r.no }}</li>
                      </ul>
                    </div>
                  </div>
                  <div class="jp_listing_overview_list_main_wrapper jb_cover">
                    <div class="jp_listing_list_icon">
                      <i class="fa fa-map-marker-alt"></i>
                    </div>
                    <div class="jp_listing_list_icon_cont_wrapper">
                      <ul>
                        <li>work/site location:</li>
                        <li>{{ r.location }}</li>
                      </ul>
                    </div>
                  </div>
                  <div class="jp_listing_overview_list_main_wrapper jb_cover">
                    <div class="jp_listing_list_icon">
                      <i class="fa fa-clock"></i>
                    </div>
                    <div class="jp_listing_list_icon_cont_wrapper">
                      <ul>
                        <li>duration:</li>
                        <li>{{ r.duration }}</li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="col-lg-6 col-md-12 col-sm-12 col-12">
                  <div class="jp_listing_overview_list_main_wrapper jb_cover">
                    <div class="jp_listing_list_icon">
                      <i class="flaticon-man-user"></i>
                    </div>
                    <div class="jp_listing_list_icon_cont_wrapper">
                      <ul>
                        <li>owner:</li>
                        <li>{{ r.owner }}</li>
                        <!-- <li><a href="mailto:{{ r.owner }}">{{ r.owner }}</a></li> -->
                        <!-- <li>{{ r.owner }}<a href="mailto:{{ r.owner }}"><i class="fa fa-link"></i></a></li> -->
                      </ul>
                    </div>
                  </div>
                  <div class="jp_listing_overview_list_main_wrapper jb_cover">
                    <div class="jp_listing_list_icon">
                      <i class="fas fa-globe"></i>
                    </div>
                    <div class="jp_listing_list_icon_cont_wrapper">
                      <ul>
                        <li>sector:</li>
                        <li>{{ r.sector }}</li>
                      </ul>
                    </div>
                  </div>
                  <div
                    class="jp_listing_overview_list_main_wrapper dcv jb_cover"
                  >
                    <div class="jp_listing_list_icon">
                      <i class="fa fa-info-circle"></i>
                    </div>
                    <div class="jp_listing_list_icon_cont_wrapper">
                      <ul>
                        <li>job description</li>
                        <li>{{ r.description }}</li>
                      </ul>
                    </div>
                  </div>
                  <div
                    class="jp_listing_overview_list_main_wrapper dcv jb_cover"
                  >
                    <div class="jp_listing_list_icon">
                      <i class="fas fa-calendar"></i>
                    </div>
                    <div class="jp_listing_list_icon_cont_wrapper">
                      <ul>
                        <li>Expiry Date</li>
                        <li>{{ r.expiryDate }}</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div
          *ngIf="auth.isAdmin(user) && r.ownerName"
          class="col-lg-12 col-md-12 col-sm-12 col-12"
        >
          <div class="job_filter_category_sidebar jb_cover">
            <div class="job_filter_sidebar_heading jb_cover">
              <h1>
                employer contact details
                <span
                  ><a href="#" data-toggle="modal" data-target="#myModal1"
                    ><i class="fas fa-edit"></i></a
                ></span>
              </h1>
            </div>
            <div class="job_overview_header jb_cover">
              <div class="row">
                <div class="col-lg-6 col-md-12 col-sm-12 col-12">
                  <div class="jp_listing_overview_list_main_wrapper jb_cover">
                    <div class="jp_listing_list_icon">
                      <i class="flaticon-man-user"></i>
                    </div>
                    <div class="jp_listing_list_icon_cont_wrapper">
                      <ul>
                        <li>Name:</li>
                        <li>{{ r.ownerName }}</li>
                      </ul>
                    </div>
                  </div>
                  <div class="jp_listing_overview_list_main_wrapper jb_cover">
                    <div class="jp_listing_list_icon">
                      <i class="fas fa-envelope"></i>
                    </div>
                    <div class="jp_listing_list_icon_cont_wrapper">
                      <ul>
                        <li>Email:</li>
                        <li>
                          <a href="mailto:{{ r.owner }}">{{ r.owner }}</a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="col-lg-6 col-md-12 col-sm-12 col-12">
                  <div class="jp_listing_overview_list_main_wrapper jb_cover">
                    <div class="jp_listing_list_icon">
                      <i class="fa fa-phone"></i>
                    </div>
                    <div class="jp_listing_list_icon_cont_wrapper">
                      <ul>
                        <li>Phone:</li>
                        <li>
                          <a href="tel:+{{ r.ownerPhone }}">{{
                            r.ownerPhone
                          }}</a>
                        </li>
                        <!-- <li><a href="mailto:{{ r.owner }}">{{ r.owner }}</a></li> -->
                        <!-- <li>{{ r.owner }}<a href="mailto:{{ r.owner }}"><i class="fa fa-link"></i></a></li> -->
                      </ul>
                    </div>
                  </div>
                  <div class="jp_listing_overview_list_main_wrapper jb_cover">
                    <div class="jp_listing_list_icon">
                      <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div class="jp_listing_list_icon_cont_wrapper">
                      <ul>
                        <li>Address:</li>
                        <li>{{ r.ownerAddress }}</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--  *ngIf="auth.isAdmin(user) || r.delivered" -->
        <div *ngIf="auth.isAdmin(user) || r.delivered" class="col-12">
          <div class="job_main_overflow jb_cover">
            <div class="latest_job_overlow jb_cover">
              <div class="manage_jobs_wrapper jb_cover">
                <div class="job_list mange_list applications_recent">
                  <h6>
                    {{
                      auth.isAdmin(user)
                        ? "confirmed applicants"
                        : "Delivered Applicants"
                    }}
                    - {{ (r.confirmed || []).length }} /
                    {{ r.no }}
                  </h6>
                </div>
              </div>

              <div
                *ngFor="let c of confirmed | async"
                class="latest_job_box jb_cover"
              >
                <div class="job_list recent_app_1">
                  <div class="recent_img">
                    <img
                      src="https://www.gravatar.com/avatar/{{
                        c.email
                      }}?d=retro"
                      alt="post_img"
                    />
                  </div>
                  <div class="recent_cntnt">
                    <h6>
                      <a>{{ c.fname }} {{ c.lname }}</a>
                    </h6>
                    <ul>
                      <li>
                        <i class="fas fa-suitcase"></i>&nbsp; {{ c.profession }}
                      </li>
                      <!-- <li>
                        <i class="flaticon-location-pointer"></i>&nbsp;
                        {{ c.address }}
                      </li> -->
                      <li>
                        <i class="fa fa-calendar"></i>&nbsp;
                        {{ c.appointDate }}
                      </li>
                    </ul>
                  </div>
                </div>

                <ng-container *ngIf="auth.isAdmin(user); else employerActions">
                  <div class="job_list_next recent_app_1">
                    <div class="header_btn search_btn jb_cover">
                      <button
                        [disabled]="r.delivered"
                        (click)="removeApplicant(r, c)"
                        class="float-right mr-4"
                      >
                        remove applicant
                        <i class="ml-1 fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                </ng-container>
                <ng-template #employerActions>
                  <div class="job_list_next recent_app_1">
                    <div class="header_btn search_btn jb_cover">
                      <a href="tel:{{ c.phone }}" class="float-right mr-4 mb-3">
                        Call
                        <i class="ml-1 fas fa-phone"></i>
                      </a>
                      <a
                        href="mailto:{{ c.email }}"
                        class="float-right mr-4 mb-3"
                      >
                        Send Mail
                        <i class="ml-1 fas fa-envelope"></i>
                      </a>
                    </div>
                  </div>
                </ng-template>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="auth.isAdmin(user)" class="col-12">
          <div class="job_main_overflow jb_cover">
            <div class="latest_job_overlow jb_cover">
              <div class="manage_jobs_wrapper jb_cover">
                <div class="job_list mange_list applications_recent">
                  <h6>
                    potential applicants -
                    {{
                      ((matchedEmployees | async) || []).length -
                        (r.confirmed || []).length
                    }}
                  </h6>
                </div>
              </div>

              <div *ngFor="let m of matchedEmployees | async">
                <div
                  *ngIf="!r.confirmed?.includes(m.email)"
                  class="latest_job_box jb_cover"
                >
                  <div class="job_list recent_app_1">
                    <div class="recent_img">
                      <img
                        src="https://www.gravatar.com/avatar/{{
                          m.email
                        }}?d=retro"
                        alt="post_img"
                      />
                    </div>
                    <div class="recent_cntnt">
                      <h6>
                        <a href="#">{{ m.fname }} {{ m.lname }}</a>
                      </h6>
                      <ul>
                        <li>
                          <i class="fas fa-briefcase"></i>&nbsp;
                          {{ m.profession }}
                        </li>
                        <li>
                          <i class="flaticon-location-pointer"></i>&nbsp;
                          {{ m.address }}
                        </li>
                      </ul>
                    </div>
                  </div>

                  <div class="job_list_next recent_app_1">
                    <div class="header_btn search_btn jb_cover">
                      <button
                        [disabled]="
                          r.delivered || r.invitees?.includes(m.email)
                        "
                        (click)="sendInvite(r, m)"
                        class="float-right mr-4"
                      >
                        {{
                          r.invitees?.includes(m.email)
                            ? "invite sent"
                            : "send invite"
                        }}
                        <i
                          class="ml-1 fas fa-{{
                            r.invitees?.includes(m.email)
                              ? 'check'
                              : 'hand-holding'
                          }}"
                        ></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- <div class="blog_pagination_section jb_cover">
                        <ul>
                          <li>
                            <a href="#" class="prev">
                              <i class="flaticon-left-arrow"></i>
                            </a>
                          </li>
                          <li><a href="#">1</a></li>
                          <li class="third_pagger"><a href="#">2</a></li>
                          <li class="d-block d-sm-block d-md-block d-lg-block">
                            <a href="#">3</a>
                          </li>
                          <li class="d-none d-sm-block d-md-block d-lg-block">
                            <a href="#">...</a>
                          </li>
                          <li class="d-none d-sm-block d-md-block d-lg-block">
                            <a href="#">6</a>
                          </li>
          
                          <li>
                            <a href="#" class="next">
                              <i class="flaticon-right-arrow"></i>
                            </a>
                          </li>
                        </ul>
                      </div> -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      *ngIf="auth.isAdmin(user)"
      class="col-lg-12 col-md-12 col-sm-12 col-12"
    >
      <div class="header_btn search_btn jb_cover">
        <button
          [disabled]="r.delivered || !((r.confirmed || []).length > 0)"
          (click)="deliverApplicants(r.id, r.owner, (r.confirmed || []).length)"
          class="mx-auto"
        >
          deliver
          {{
            (r.confirmed || []).length > 0 ? (r.confirmed || []).length : "No"
          }}
          applicant
          <i class="ml-1 fas fa-check"></i>
        </button>
      </div>
    </div>
  </div>
</div>
